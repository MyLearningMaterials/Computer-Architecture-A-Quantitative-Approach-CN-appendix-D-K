# D.5 排队理论简介

在处理器设计中，我们有简单的与第1章CPI公式相关的性能计算，或者我们可以使用全尺寸模拟，以更高的成本获得更高的精度。在I/O系统中，我们也有一个最佳情况分析，作为一个粗略的计算。全尺寸模拟也更加精确，计算预期性能需要更多的工作。

然而，对于I/O系统，我们也有一个数学工具来指导I/O设计，这比最佳情况分析要多一点工作，也要准确得多，但比全面模拟要少得多。由于I/O事件的概率性质和I/O资源的共享，我们可以给出一组简单的定理，这些定理将有助于计算整个I/O系统的响应时间和吞吐量。这个有用的领域被称为**排队论**。由于有许多关于这个主题的书籍和课程，本节只作为这个主题的第一个介绍。但即使是这个很小的量也可以导致更好的I/O系统设计。

让我们从I/O系统的黑盒方法开始，如图D.15所示。在我们的示例中，处理器发出到达I/O设备的I/O请求，当I/O设备完成请求时，请求“离开”。

我们通常对系统的长期或稳定状态感兴趣，而不是最初的启动条件。假设我们不是。尽管有数学的帮助(马尔可夫链)，除了少数情况，解决结果方程的唯一方法是模拟。由于本节的目的是展示一些比粗略计算更难但比模拟更简单的东西，因此我们在这里不讨论此类分析。(详情请参阅[附录M](../fu-lumli-shi-guan-dian-he-can-kao.md)中的参考文献)

<figure><img src="../.gitbook/assets/image.png" alt=""><figcaption><p>图D.15将I/O系统视为黑匣子。这导致了一个简单但重要的观察结果:如果系统处于稳定状态，那么进入系统的任务数量必须等于离开系统的任务数量。这种流动平衡状态对于稳定状态是必要的，但不是充分的。如果系统已经被观察或测量了足够长的时间，并且平均等待时间稳定下来，那么我们就说系统已经达到稳定状态。</p></figcaption></figure>

因此，在本节中，我们做了一个简化的假设，即我们正在评估具有多个处于平衡状态的独立I/O服务请求的系统：输入速率必须等于输出速率。我们还假设有稳定的任务供应，它们等待服务的时间是独立的。在许多实际系统中，比如TPC-C，任务消耗率是由其他系统特征决定的，比如内存容量。

这就引出了利特尔定律，它与系统中任务的平均数量、新任务的平均到达率和执行任务的平均时间有关：

<figure><img src="../.gitbook/assets/image (1).png" alt=""><figcaption></figcaption></figure>

利特尔定律适用于任何处于平衡状态的系统，只要黑盒子里没有任何东西创造或破坏新任务。注意，到达率和响应时间必须使用相同的时间单位；时间单位不一致是造成错误的常见原因。
